<!DOCTYPE html>

<head>
	<meta charset="utf-8">
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
	<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
	<script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
</head>

<body>
	<div class = "col-sm-offset-5">
		<h3 id="ChartName">Pie Chart</h3>
	</div>
	<div id="pie">
	</div>
	<div class = "container">
		<div class="row">
			<div class="col-md-4">
				<div class="input-group">
					<input type="text" id="result" placeholder="ratio">
				</div>
			</div>
			<div class="col-md-2">
				<button onclick="submitFunction()" class="btn btn-primary">Next</button>
			</div>
		</div>
	</div>
	<script type="text/javascript">
			var margin = {top: 40, right: 20, bottom: 40, left: 40};
			var width = 600 - margin.left - margin.right;
			var height = 300 - margin.top - margin.bottom;
			var radius = Math.min(width, height) / 2;

			var svg = d3.select("#pie").append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + (width / 2 + 50) + "," + (height / 2 + 40) + ")");

			var pie = d3.pie()
						.value(function(d) { return d.value; });

			var path = d3.arc()
						.outerRadius(radius - 10)
						.innerRadius(0);

			var true_value = 0;
			var input_value = 0;

			d3.csv("points.csv", function(error, data){

				if(error){
					throw error;
				}

				data = d3.shuffle(data);


				var index1 = Math.floor(Math.random() * 9);
				var index2 = Math.floor(Math.random() * 9);
				while(index2 == index1)
					index2 = Math.floor(Math.random() * 9);

				if(Number(data[index1].value) > Number(data[index2].value)){
					true_value = Number(data[index2].value) / Number(data[index1].value) * 100;
				}
				else{
					true_value = Number(data[index1].value) / Number(data[index2].value) * 100;
				}

				var pos = [path.centroid(pie(data)[index1]), path.centroid(pie(data)[index2])];
				console.log(pos);

				console.log(data[index1].value);
				console.log(data[index2].value);
				console.log(true_value);

				var arc = svg.append("g")
							.selectAll(".arc")
							.data(pie(data))
							.enter().append("g")
							.attr("class", "arc")
							.attr("stroke", "white")
  							.style("stroke-width", "2px");

				arc.append("path")
					.attr("d", path)
					.attr("fill", "gray");

				svg.append("g")
					.selectAll("circle1")
					.data(data)
					.enter().append("circle")
					.attr("cx", pos[0][0])
					.attr("cy", pos[0][1])
					.attr("r", 3)
					.style("fill", "white");

				svg.append("g")
					.selectAll("circle2")
					.data(data)
					.enter().append("circle")
					.attr("cx", pos[1][0])
					.attr("cy", pos[1][1])
					.attr("r", 3)
					.style("fill", "white");
			})
			function submitFunction(){
				var ChartName = escape(document.getElementById("ChartName").innerHTML);
				input_value = escape(document.getElementById("result").value);

				var url = window.location.search;
				var text = url.substr(1);
				var params = text.split("&");
				var s = new Object();
				for(var i = 0; i < params.length; i++){
					s[params[i].split("=")[0]] = unescape(params[i].split("=")[1]);
				}

				window.location.href = "https://888king.github.io/cs573_experiment/result.html?name=" + escape(s["name"]) + "&Chart1=" + escape(s["Chart1"]) + "&input1=" + escape(s["input1"]) + "&true1=" + escape(s["true1"]) + "&Chart2=" + escape(s["Chart2"]) + "&input2=" + escape(s["input2"]) + "&true2=" + escape(s["true2"]) + "&Chart3=" + ChartName + "&input3=" + input_value + "&true3=" + escape(true_value);
			}
		</script>
</body>
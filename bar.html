<!DOCTYPE html>

<head>
	<meta charset="utf-8">
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
	<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">
	<script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
</head>

<body>
	<div class = "col-md-offset-1">
		<h3 id="ChartName">Bar Chart</h3>
	</div>
	<div id="bar">
	</div>
	<div class = "container">
		<div class="row">
			<div class="col-md-4">
				<div class="input-group">
					<input type="text" id="result" placeholder="ratio">
				</div>
			</div>
			<div class="col-md-2">
				<button onclick="submitFunction()" class="btn btn-primary">Next</button>
			</div>
		</div>
	</div>
	<script type="text/javascript">
			var margin = {top: 40, right: 20, bottom: 40, left: 40};
			var width = 600 - margin.left - margin.right;
			var height = 300 - margin.top - margin.bottom;
			
			var xAxis = d3.scaleBand().range ([0, width]).padding(0.4);

			var yAxis = d3.scaleLinear().range([height, 0]);

			var svg = d3.select("#bar").append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			var index1 = Math.floor(Math.random() * 9);
			var index2 = Math.floor(Math.random() * 9);
			var true_value = 0;
			var input_value = 0

			d3.csv("points.csv", function(error, data){
				if(error){
					throw error;
				}

				data = d3.shuffle(data);

				while(index2 == index1)
					index2 = Math.floor(Math.random() * 9);

				if(Number(data[index1].value) > Number(data[index2].value)){
					true_value = Number(data[index2].value) / Number(data[index1].value) * 100;
				}
				else{
					true_value = Number(data[index1].value) / Number(data[index2].value) * 100;
				}

				var data2 = [data[index1], data[index2]];
				console.log(true_value);


				xAxis.domain(data.map(function(d) { return d.index; }));
				yAxis.domain([0, 40]);

				svg.append("g")
					.attr("transform", "translate(" + 0 + "," + height + ")")
					.call(d3.axisBottom(xAxis).tickFormat((domainn,number)=>{return ""}));

				svg.append("g")
					.call(d3.axisLeft(yAxis).tickFormat((domainn,number)=>{return ""}));

				svg.append("g")
					.selectAll(".bar")
					.data(data)
					.enter().append("rect")
					.attr("class", "bar")
					.attr("x", function(d) { return xAxis(d.index); })
					.attr("y", function(d) { return yAxis(d.value); })
					.attr("width", xAxis.bandwidth())
					.attr("height", function(d) { return height - yAxis(d.value); })
					.style("fill", "gray");

				svg.append("g")
					.selectAll("circle")
					.data(data2)
					.enter().append("circle")
					.attr("cx", function(d) { return xAxis(d.index) + 0.5 * xAxis.bandwidth(); })
					.attr("cy", function(d) { return 0.5 * (height + yAxis(d.value)); })
					.attr("r", 3)
					.style("fill", "white");
				
			})
			function submitFunction(){
				var ChartName = escape(document.getElementById("ChartName").innerHTML);
				input_value = escape(document.getElementById("result").value);

				var url = window.location.search;
				var text = url.substr(1);
				var params = text.split("&");
				var s = new Object();
				for(var i = 0; i < params.length; i++){
					s[params[i].split("=")[0]] = unescape(params[i].split("=")[1]);
				}

				window.location.href = "http://localhost:8000/pie.html?name=" + escape(s["name"]) + "&Chart1=" + escape(s["Chart1"]) + "&input1=" + escape(s["input1"]) + "&true1=" + escape(s["true1"]) + "&Chart2=" + ChartName + "&input2=" + input_value + "&true2=" + escape(true_value);
			}
		</script>
</body>